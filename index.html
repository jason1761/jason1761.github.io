<!DOCTYPE html>
<html lang="en">
<head>
    <meta name="HandheldFriendly" content="True">
    <meta name="MobileOptimized" content="320">
    <meta name="viewport" content="width=device-width, target-densitydpi=160dpi, initial-scale=1">
    <script src="ios-orientationchange-fix.min.js"></script>
    <link rel="stylesheet" href="style.css">
</head>
<body>
<div class="main">
    <img src="source.jpg"/>
</div>
<script src="jquery.min.js"></script>
<script>

    var json = [];
    $(document).ready(function () {
        $.ajaxSetup({
            async: false
        });

        $.getJSON('content.json', function (rs) {
            json = rs;
        });
        console.log(json);
        $.each(json, function () {
            var obj = this;
            var elm = $('.main');
            var $newdiv1 = $("<div class='badge' id='badge-" + obj.alt + "'>" + obj.alt + "</div>");
            console.log(elm.offset());
            $($newdiv1).css({
                "top": obj.y,
                "left": obj.x - 5,
                "position": "absolute"
            });
            $('.main').append($newdiv1);
        });
    });

    function mousemove(event) {
        // console.log("pageX: ", event.pageX,
        //     "pageY: ", event.pageY,
        //     "clientX: ", event.clientX,
        //     "clientY:", event.clientY)

        var elm = $('.main');
        var xPos = event.pageX - elm.offset().left;
        var yPos = event.pageY - elm.offset().top;

        // console.log("xPos: ", xPos, "yPos: ", yPos);
        show(xPos, yPos);
    }

    window.addEventListener('mousemove', mousemove);


    $('.main').click(function (e) {
        console.log(e);
        var elm = $(this);
        var xPos = e.pageX - elm.offset().left;
        var yPos = e.pageY - elm.offset().top;
        // console.log(xPos, yPos);
        show(xPos, yPos);
    });

    function show(xPos, yPos) {
        $.each(json, function () {
            var obj = this;
            var rX = xPos - obj.x;
            var rY = yPos - obj.y;
            if (rX <= 15 && rX >= -15) {
                // console.log(obj.x);
                if (rY <= 15 && rY >= -15) {
                    console.log("xPos:", xPos, " obj.x:", obj.x, "rX=", rX, "yPos:", yPos, " obj.x:", obj.y + "rY=", rY)
                    var $newdiv1 = $("<div class='badge' id='badge-" + obj.alt + "'>" + obj.alt + "</div>");
                    $($newdiv1).css({
                        "top": obj.y,
                        "left": obj.x - 5,
                        "position": "absolute"
                    });
                    $('.badge').remove();
                    $('#badge-' + obj.alt + '').remove();
                    // $('.main').append($newdiv1);
                }

            }

        });
    }
</script>
</body>
</html>